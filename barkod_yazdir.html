<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>Barkod Yazdır</title>

<style>
  @page {
    size: 100mm 100mm;
    margin: 0;
  }
  html, body {
    width: 100mm; height: 100mm;
    margin: 0; padding: 0;
    font-family: Arial, sans-serif;
    font-size: 10px;
  }

  .wrap {
    display: grid;
    grid-template-columns: 35mm 40mm 25mm;
    width: 100mm; height: 100mm;
  }

  /* Sol uzun barcode alanı */
  .left {
    padding: 2mm;
    text-align: center;
  }
  #longBarcode {
    width: 100%;
  }

  /* Orta alıcı bilgileri */
  .middle {
    padding: 1mm;
    border-left: 1px solid #000;
    border-right: 1px solid #000;
  }
  .box-title {
    font-weight: bold;
    border-bottom: 1px solid #000;
    margin-bottom: 2px;
  }

  /* Sağ büyük kod alanı */
  .right {
    padding: 1mm;
    text-align: center;
  }
  .big-code {
    font-size: 18px;
    font-weight: bold;
    margin-top: 2mm;
  }
  .invoice-id {
    font-size: 14px;
    font-weight: bold;
    margin-top: 3mm;
  }
  #qr {
    width: 22mm;
    height: 22mm;
    margin: 2mm auto 0 auto;
  }
  .barcode-text {
    margin-top: 2mm;
    font-weight: bold;
    font-size: 10px;
  }
</style>
</head>
<body>

<div class="wrap">

  <!-- SOL BARCODE -->
  <div class="left">
    <svg id="longBarcode"></svg>
  </div>

  <!-- ORTA ALAN (ALICI BİLGİLERİ) -->
  <div class="middle">
    <div class="box-title">Alıcı</div>
    <div id="alici"></div>

    <div style="margin-top:3mm;">
      <b>Adres:</b><br>
      <span id="adres"></span>
    </div>

    <div style="margin-top:3mm;">
      <b>Şehir/İlçe:</b><br>
      <span id="sehir"></span> / <span id="ilce"></span>
    </div>

    <div style="margin-top:3mm;">
      <b>Tel:</b> <span id="tel"></span>
    </div>

    <div style="margin-top:3mm;">
      <b>Ürün Bedeli:</b> <span id="bedel"></span> ₺
    </div>
  </div>

  <!-- SAĞ BÖLÜM -->
  <div class="right">
    <div style="font-size:14px; font-weight:bold;">DK-4</div>

    <div class="invoice-id" id="invoiceid"></div>

    <canvas id="qr"></canvas>

    <div class="barcode-text" id="barcodeTxt"></div>
  </div>

</div>

<!-- jsBarcode & QR code -->
<script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.5/dist/JsBarcode.all.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/qrious/dist/qrious.min.js"></script>

<script>
/*
  window.showLabel(orderObj)
  — app.js'ten bu sayfa açılınca verileri buraya aktaracağız.
*/
window.showLabel = function (d) {

  // 1) Uzun çizgi barkod
  JsBarcode("#longBarcode", d.kargo_takip_kodu, {
    format: "CODE128",
    lineColor: "#000",
    width: 2,
    height: 260,
    displayValue: false,
    margin: 0
  });

  // 2) QR kod (kargo_qr_kod)
  new QRious({
    element: document.getElementById("qr"),
    value: d.kargo_qr_kod,
    size: 180
  });

  // 3) Bilgileri doldur
  document.getElementById("alici").innerText = d.ad_soyad;
  document.getElementById("adres").innerText = d.adres;
  document.getElementById("sehir").innerText = d.sehir;
  document.getElementById("ilce").innerText = d.ilce;
  document.getElementById("tel").innerText = d.musteri_tel;
  document.getElementById("bedel").innerText = d.toplam_tutar;

  // Büyük kod (invoiceid)
  document.getElementById("invoiceid").innerText = d.invoiceid;

  // Alt barkod yazısı
  document.getElementById("barcodeTxt").innerText = d.kargo_takip_kodu;

  // 4) Yazdır ve kapat
  setTimeout(() => {
    window.print();
    setTimeout(() => window.close(), 400);
  }, 300);
};
</script>

</body>
</html>
